<% cache(content) do %>
<% options = local_assigns.fetch(:options, {}) %>
<% output = capture do %>
  <%- if options[:shorten_to].blank? -%>
  <%= raw content.essence.send(options[:plain_text] ? :stripped_body : :body) %>
  <%- else -%>
  <%= raw content.essence.send(options[:plain_text] ? :stripped_body : :body).split(" ").first(options[:shorten_to]).join(" ") + (options[:shorten_suffix] || 'â€¦') %>
  <%- end -%>
<% end %>
<% if @preview_mode %>
<alchemy:content data-alchemy-content-id="<%= content.id %>">
  <%= output %>
</alchemy:content>
<% else %>
<%= output %>
<% end %>
<% end %>
